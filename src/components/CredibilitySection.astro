---
// Importa e ordena as imagens
const images = (await Astro.glob("../assets/images/samuel-*.*")).sort(
  (a: any, b: any) => {
    const getIndex = (img: any) => {
      const match = img.default.src.match(/samuel-(\d+)/);
      return match ? Number(match[1]) : 0;
    };
    return getIndex(a) - getIndex(b);
  }
);

// Resolve a legenda
const getBadgeText = (index: number) => {
  const i = index + 1;
  if (i >= 1 && i <= 6) return "üöÄ 1¬∫ Agilizem Day Fortaleza";
  if (i >= 7 && i <= 11) return "üìà CGLP 2025";
  if (i >= 12 && i <= 15) return "üìö VIII Encontros Acad√™micos";
  if (i >= 16 && i <= 18) return "üéØ FB Startup Day";
  if (i >= 19 && i <= 22) return "üõ†Ô∏è FLF - Treinamento Pr√°tico de Gest√£o √Ågil";
  if (i >= 23 && i <= 27) return "üå± [PMI-CE] Conex√µes que Transformam";
  return "";
};
---

<section id="expertise" class="w-full py-20 overflow-hidden">
  <div class="w-full max-w-7xl mx-auto px-6 lg:px-24">
    <div class="flex flex-col items-center text-center gap-4 mb-12">
      <div class="inline-flex px-4 py-2 rounded-full border border-white/12 bg-linear-to-r from-white/4 to-transparent">
        <span class="text-white text-xs font-medium leading-tight">
          ‚ú® Credibilidade e Expertise Comprovada
        </span>
      </div>
      <h2 class="text-3xl lg:text-4xl font-semibold text-[#F2F2F2] font-outfit leading-tight max-w-md">
        Em quem voc√™ confia para aprender IA?
      </h2>
      <p class="text-sm text-white/80 leading-normal max-w-lg">
        Com +15 anos de experi√™ncia e reconhecido por liderar a <br />
        inova√ß√£o em empresas como DELL e HP, Samuel Santiago n√£o <br />
        apenas fala sobre transforma√ß√£o digital; ele a entrega.
      </p>
    </div>

    <div class="relative w-full overflow-visible">
      <div class="carousel-stage relative mx-auto overflow-visible">
        
        <button class="carousel-prev absolute top-1/2 -translate-y-1/2 z-40 w-12 h-12 flex items-center justify-center rounded-full bg-white/10 hover:bg-white/20 transition backdrop-blur-sm" aria-label="Anterior">
          <i class="ri-arrow-left-line text-white text-3xl"></i>
        </button>

        <div class="carousel-track relative flex items-center justify-center overflow-visible">
          {images.map((image, index) => (
            <div class="carousel-item" data-index={index}>
              <img 
                src={image.default.src} 
                alt={`Evento Samuel ${index + 1}`} 
                loading="lazy" 
                decoding="async"
              />
              <div class="badge">{getBadgeText(index)}</div>
            </div>
          ))}
        </div>

        <button class="carousel-next absolute top-1/2 -translate-y-1/2 z-40 w-12 h-12 flex items-center justify-center rounded-full bg-white/10 hover:bg-white/20 transition backdrop-blur-sm" aria-label="Pr√≥ximo">
          <i class="ri-arrow-right-line text-white text-3xl"></i>
        </button>

      </div>
    </div>
  </div>

  <style>
    :root {
      /* --- Desktop Padr√£o --- */
      --item-width: 39.375rem; 
      --gap-1: 34rem; 
      --gap-2: 45rem; 
      --scale-0: 1.05;
      --scale-1: 0.55;
      --scale-2: 0.40;
      /* Opacidade padr√£o dos vizinhos no desktop */
      --opacity-1: 0.5;
    }

    /* Tablet */
    @media (max-width: 1024px) {
      :root {
        --item-width: 30rem;
        --gap-1: 22rem;
        --gap-2: 30rem;
        --scale-1: 0.45;
      }
      .carousel-prev, .carousel-next { display: none; }
    }

    /* --- MOBILE (Ajuste para slide lateral e Badge) --- */
    @media (max-width: 640px) {
      :root {
        /* O item ocupa 100% da largura dispon√≠vel */
        --item-width: 100%; 
        
        /* O vizinho fica 105% para o lado (sai da tela) */
        --gap-1: 105%;
        --gap-2: 0px; /* N√£o usamos o n√≠vel 2 no mobile */
        
        /* Sem escala, tudo tamanho real */
        --scale-0: 1;
        --scale-1: 1;

        /* Vizinhos vis√≠veis (opacity 1) para podermos ver o slide acontecendo */
        --opacity-1: 1; 
      }

      .carousel-stage { width: 100% !important; }
      .carousel-track { perspective: none !important; }

      /* Ajustes finos no item mobile */
      .carousel-item {
        /* Garante que a transi√ß√£o de posi√ß√£o seja fluida */
        transition: transform 0.5s cubic-bezier(0.25, 1, 0.5, 1) !important;
        box-shadow: none !important;
      }

      /* No mobile, escondemos totalmente os itens distantes (n√≠vel 2) para performance */
      .carousel-item.pos-2, .carousel-item.pos-n2 {
         display: none;
      }

      /* --- AJUSTE DA LEGENDA (BADGE) NO MOBILE --- */
      .badge {
        top: auto !important;    /* Remove a posi√ß√£o do topo */
        bottom: 0.8rem;          /* Fixa na parte de baixo */
        font-size: 0.5rem !important; /* Texto menor */
        padding: 0.4rem 0.8rem !important; /* Badge mais compacta */
        max-width: 85% !important; /* Garante margem nas laterais */
      }
    }
    /* ------------------------------------ */

    .carousel-stage { width: var(--item-width); }
    .carousel-prev { left: -4rem; cursor: pointer; }
    .carousel-next { right: -4rem; cursor: pointer; }

    .carousel-track {
      perspective: 1000px;
      touch-action: pan-y;
      aspect-ratio: 16/9;
      width: 100%;
    }

    .carousel-item {
      position: absolute;
      width: var(--item-width);
      aspect-ratio: 16/9;
      border-radius: 1rem;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: #0a0a0a;
      
      /* Estado base (escondido) */
      opacity: 0;
      visibility: hidden;
      transform: scale(0.3);
      z-index: 0;
      pointer-events: none;
      
      transition: transform 0.5s cubic-bezier(0.25, 1, 0.5, 1),
                  opacity 0.5s ease,
                  visibility 0.5s steps(1, end);
      will-change: transform, opacity;
    }

    .carousel-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* --- ESTADOS DE POSI√á√ÉO --- */

    /* Item Central (0) */
    .carousel-item.pos-0 {
      opacity: 1;
      visibility: visible;
      z-index: 30;
      transform: translateX(0) scale(var(--scale-0));
      pointer-events: auto;
      box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    }

    /* Vizinhos Imediatos (-1 e +1) */
    /* No mobile, eles usam --gap-1 que vale 105%, jogando-os para fora da tela */
    .carousel-item.pos-1, 
    .carousel-item.pos-n1 {
      opacity: var(--opacity-1); /* Usa a vari√°vel que √© 0.5 no desktop e 1 no mobile */
      visibility: visible;
      z-index: 20;
    }

    /* Move para a direita */
    .carousel-item.pos-1 { 
      transform: translateX(var(--gap-1)) scale(var(--scale-1)) translateY(2rem); 
    }
    /* No mobile removemos o translateY para alinhar perfeitamente */
    @media (max-width: 640px) {
      .carousel-item.pos-1 { transform: translateX(var(--gap-1)); }
    }

    /* Move para a esquerda */
    .carousel-item.pos-n1 { 
      transform: translateX(calc(-1 * var(--gap-1))) scale(var(--scale-1)) translateY(2rem); 
    }
    @media (max-width: 640px) {
      .carousel-item.pos-n1 { transform: translateX(calc(-1 * var(--gap-1))); }
    }


    /* Vizinhos Distantes (-2 e +2) - Apenas Desktop */
    .carousel-item.pos-2, 
    .carousel-item.pos-n2 {
      opacity: 0.2;
      visibility: visible;
      z-index: 10;
    }
    .carousel-item.pos-2 { transform: translateX(var(--gap-2)) scale(var(--scale-2)) translateY(2rem); }
    .carousel-item.pos-n2 { transform: translateX(calc(-1 * var(--gap-2))) scale(var(--scale-2)) translateY(2rem); }

    /* Badge Default (Desktop) */
    .badge {
      position: absolute;
      top: 1rem;
      left: 50%;
      transform: translateX(-50%);
      padding: 0.5rem 1rem;
      border-radius: 2rem;
      font-size: 0.75rem;
      color: white;
      text-align: center;
      background: rgba(86, 86, 86, 0.195);
      backdrop-filter: blur(4px);
      border: 1px solid rgba(255,255,255,0.1);
      width: max-content;
      max-width: 90%;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 40;
    }
    .carousel-item.pos-0 .badge { opacity: 1; }

  </style>

  <script type="module">
    const items = Array.from(document.querySelectorAll(".carousel-item"));
    const prevBtn = document.querySelector(".carousel-prev");
    const nextBtn = document.querySelector(".carousel-next");
    const track = document.querySelector(".carousel-track");
    
    const total = items.length;
    let active = 0;

    function render() {
      items.forEach((item, index) => {
        item.classList.remove("pos-0", "pos-1", "pos-n1", "pos-2", "pos-n2");
        
        let offset = (index - active + total) % total;
        
        if (offset > total / 2) offset -= total;
        if (offset < -total / 2) offset += total;

        if (offset === 0) item.classList.add("pos-0");
        else if (offset === 1) item.classList.add("pos-1");
        else if (offset === -1) item.classList.add("pos-n1");
        else if (offset === 2) item.classList.add("pos-2");
        else if (offset === -2) item.classList.add("pos-n2");
      });
    }

    function goNext() {
      active = (active + 1) % total;
      render();
    }

    function goPrev() {
      active = (active - 1 + total) % total;
      render();
    }

    prevBtn?.addEventListener("click", goPrev);
    nextBtn?.addEventListener("click", goNext);

    let startX = 0;
    let isDragging = false;

    function onStart(e) {
      isDragging = true;
      startX = e.type.includes("mouse") ? e.clientX : e.touches[0].clientX;
    }

    function onEnd(e) {
      if (!isDragging) return;
      const endX = e.type.includes("mouse") ? e.clientX : e.changedTouches[0].clientX;
      const diff = endX - startX;

      if (Math.abs(diff) > 50) {
        if (diff > 0) goPrev();
        else goNext();
      }
      isDragging = false;
    }

    track?.addEventListener("touchstart", onStart, { passive: true });
    track?.addEventListener("touchend", onEnd);
    track?.addEventListener("mousedown", onStart);
    track?.addEventListener("mouseup", onEnd);
    track?.addEventListener("mouseleave", () => (isDragging = false));

    render();
  </script>
</section>